---
title: "chapter4"
author: "Nicolás Morales"
date: "10/5/2021"
output: pdf_document
keep_tex: yes
---

\section*{Modelamiento}

\subsection{Análisis de Correlación}
Se realizó un análisis de correlación entre las variables disponibles. La figura \ref{fig:corrplot} se muestra una representación gráfica de la matriz de correlaciones, donde rojo y azul corresponden a $-1$ y $1$ respectivamente.

```{r, echo = F}
# library("corrplot")
cors = cor(DF[,c("SMM","DESEMPLEO","IMACEC","BCU10","PIB","TM","Interbancaria")])
corrplot(cors, type = "lower", diag = F,  cl.pos = "n", method = "square")
```

Nótese en primer lugar que existe poca correlación entre la variable objetivo (SMM) y las demás variables disponibles. En segundo lugar, es necesario poner atención a algunas correlaciones muy potentes entre regresores (como IMACEC y PIB), lo cual si bien es esperable tratándose de variables macroeconómicas, advierten sobre un posible problema de multicolinealidad entre ellas. 

\subsection{Modelo lineal para SMM}

Los posibles modelos lineales construidos se muestran en Tabla \ref{tab:tab_reg}. Los modelos $2-4$ fueron construidos a partir de retirar los regresores no significativos, mientras que el quinto fue construido mediante métodos \textit{stepwise} (cabe mencionar que tanto el método \textit{both} como \textit{backward} entregaron como resultado el mismo modelo). Como se muestra en la misma, el quinto modelo marca mejor ajuste por el criterio de $R^2$ y un mejor $AIC$. La columna N.S. indica la cantidad de regresores \textbf{no significativos} sobre el total de regresores del modelo, favorablemente el modelo mencionado no posee coeficientes no significativos, por lo que es el modelo más idóneo de entre las opciones presentadas. 

```{r, include=FALSE}
fit01 = lm(SMM ~ ., data = DF)
datos01 = summary(fit01)

fit02 = lm(SMM ~ .-DIC-SEPT-JUN-MAR, data = DF)
datos02 = summary(fit02)

fit03 = lm(SMM ~ .-DESEMPLEO-IMACEC-PIB-Interbancaria, data = DF)
datos03 = summary(fit03)

fit04 = lm(SMM ~ 1 +TM +BCU10 +ENE +ABR +MAY +JUL +AGO +OCT +NOV, data = DF)
datos04 = summary(fit04)

step01 = stepAIC(fit01, direction = "backward", trace = FALSE)
d01 = summary(step01)

step02 = stepAIC(fit01, direction = "both", trace = FALSE)
d02 = summary(step02)

fit05 = lm(SMM ~ PIB + ENE + FEB + ABR + MAY + JUL + AGO + OCT + NOV + BCU10, data = DF)
d03 = summary(fit05)
```

```{r, echo=FALSE, eval=FALSE}
library("kableExtra")
text_tbl <- data.frame(
Modelo = c("(1)", "(2)", "(3)",  "(4)", "(5)"),
Regresores = c(
"Todas las variables, incluyendo meses más intercepto",
"Desempleo, IMACEC, PIB, TM, Interbancaria, BCU10, Ene, Feb, Abr, May, Jul, Ago, Oct, Nov",
"Intercepto, TM, BCU10, Ene, Feb, Mar, Abr, May, Jun, Jul, Ago, Sep, Oct, Nov, Dic",
"Intercepto, TM, BCU10, ENE, ABR, MAY, JUL, AGO, OCT, NOV",
"Intercepto, PIB, TM, BCU10, ENE, FEB, ABR, MAY, JUL, AGO, OCT, NOV"
)
)
kable(text_tbl, "latex", booktabs = T, linesep = "\\addlinespace", 
      caption = "Modelos lineales candidatos\\label{tab:tab_reg}"
      ) %>%
kable_styling(full_width = F) %>%
column_spec(1, bold = T, color = "red", width = "15mm") %>%
column_spec(2, width = "55mm")

```

```{r, echo=FALSE, eval=TRUE}
library("kableExtra")
text_tbl <- data.frame(
Modelo = c("(1)", "(2)", "(3)",  "(4)", "(5)"),
R2 = c(0.39336, 0.38897, 0.37906, 0.34989, 0.38792),
R2aj = c(0.32551, 0.33378, 0.32732, 0.31332, 0.34531),
AIC = c(-1533.501, -1538.276, -1537.542, -1537.737, -1543.983),
NS = c("11/19", "5/15", "5/15", "0/10", "0/12")
)
head(text_tbl)
# kable(text_tbl, "latex", booktabs = T, linesep = "\\addlinespace", 
#       caption = "M ́etricas de bondad de ajuste\\labeltab:metricas}"
#       ) %>%
# kable_styling(full_width = F) %>%
# column_spec(1, bold = T, color = "red", width = "15mm") %>%
# column_spec(2, width = "55mm")

```

Como se muestra en Tabla \ref{tab:metricas} el quinto modelo marca mejor ajuste por el criterio de $R^2$ y un mejor $AIC$. La columna N.S. indica la cantidad de regresores \textbf{no significativos} sobre el total de regresores del modelo. 



A pesar de lo señalado anteriormente, un análisis de multicolinealidad al modelo seleccionado, arroja que existe un problema de colinealidad. Éste análisis se hará mediante el cálculo del factor de inflación de la varianza VIF por sus siglas en inglés (para mayor información véase  \cite{seber2012linear}), el cual se define  concretamente entre TM y BCU10:

```{r}
vif(step01)
```

Al construir un nuevo modelo retirando el regresor TM y compararlo con los preexistentes, se obtiene que sus métricas son: $R^2 = 0.37384$, $R_{aj}^2 = 0.33446$, $AIC = -1542.118$, NS: $0/11$. Son cercanas a las del anterior modelo y al aplicar nuevamente el análisis de colinealidad concluimos que está libre de ésta,  por lo que finalmente se selecciona éste como modelo final (Ver Código 2)

```{r}
step01
```

\subsection{Modelo SARIMA para los residuos}

Se modelarán ahora los residuos del modelo seleccionado con anterioridad como una serie de tiempo. En la Figura \ref{fig:acf} se muestran sus gráficos de auto-correlación y auto-correlación parcial, a partir del cual es posible observar su comportamiento estacional, auto-regresivo o de media móvil.


